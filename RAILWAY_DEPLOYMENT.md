# Railway Deployment Guide - WolvCapital

This guide covers deploying the WolvCapital Django backend to Railway.app with PostgreSQL database.

## üöÇ Railway Deployment Overview

Railway provides:
- **Automatic deployments** from GitHub
- **Built-in PostgreSQL** database provisioning
- **Environment variable management**
- **Zero-downtime deployments**
- **Automatic HTTPS** with custom domains
- **Simple scaling** and resource management

## üìã Prerequisites

1. **Railway Account**: Sign up at [railway.app](https://railway.app)
2. **GitHub Repository**: Your code should be in a GitHub repository
3. **Resend API Key**: For email notifications (get from [resend.com](https://resend.com))
4. **Custom Domain** (optional): For production deployment

## üöÄ Quick Start Deployment

### Step 1: Create New Project

1. Go to [Railway Dashboard](https://railway.app/dashboard)
2. Click **"New Project"**
3. Select **"Deploy from GitHub repo"**
4. Authorize Railway to access your repository
5. Select the `solid-succotash` repository

### Step 2: Add PostgreSQL Database

1. In your Railway project, click **"+ New"**
2. Select **"Database"** ‚Üí **"PostgreSQL"**
3. Railway will automatically:
   - Provision a PostgreSQL instance
   - Create a `DATABASE_URL` environment variable
   - Link it to your Django service

### Step 3: Configure Environment Variables

In Railway dashboard, go to your Django service ‚Üí **Variables** tab and add:

#### Required Variables

```bash
# Django Core
SECRET_KEY=<generate-random-50-char-string>
DEBUG=0
DJANGO_SETTINGS_MODULE=wolvcapital.settings

# Database (auto-generated by Railway)
DATABASE_URL=${{Postgres.DATABASE_URL}}

# Domains - Update with your Railway domain
ALLOWED_HOSTS=wolvcapital-production.up.railway.app
CORS_ALLOWED_ORIGINS=https://wolvcapital.com,https://www.wolvcapital.com
CSRF_TRUSTED_ORIGINS=https://wolvcapital.com,https://www.wolvcapital.com,https://wolvcapital-production.up.railway.app

# Frontend URLs
FRONTEND_URL=https://wolvcapital.com
PUBLIC_SITE_URL=https://wolvcapital.com
ADMIN_SITE_URL=https://wolvcapital-production.up.railway.app

# Email Configuration
DEFAULT_FROM_EMAIL=WolvCapital <support@mail.wolvcapital.com>
RESEND_API_KEY=re_<your-resend-api-key>

# Performance
WEB_CONCURRENCY=2
```

#### Optional Variables

```bash
# Custom domain for API
CUSTOM_DOMAIN=api.wolvcapital.com

# Additional email settings
SERVER_EMAIL=server@wolvcapital.com
ADMIN_EMAIL=admin@wolvcapital.com
```

### Step 4: Deploy

Railway will automatically deploy when you push to your GitHub repository's main branch.

**Manual Deploy**:
1. Go to your service in Railway dashboard
2. Click **"Deploy"** ‚Üí **"Deploy Now"**

## üîß Configuration Files

### railway.json
Defines build and deployment settings for Railway.

### nixpacks.toml
Specifies Python version and build process using Nixpacks.

### start.sh
Production startup script that:
- Runs database migrations
- Collects static files
- Seeds investment plans
- Starts Gunicorn server

## üìä Post-Deployment Setup

### 1. Create Superuser (Admin)

```bash
# Using Railway CLI
railway run python manage.py createsuperuser

# Or via Railway dashboard shell
python manage.py createsuperuser
```

### 2. Verify Investment Plans

```bash
railway run python manage.py shell
>>> from investments.models import InvestmentPlan
>>> InvestmentPlan.objects.all()
# Should show 4 plans: Pioneer, Vanguard, Horizon, Summit
```

### 3. Test Health Check

Visit: `https://your-app.up.railway.app/healthz/`

Should return: `{"status": "ok", "environment": "production"}`

## üåê Custom Domain Setup

### 1. Add Domain in Railway

1. Go to your service ‚Üí **Settings** ‚Üí **Domains**
2. Click **"Custom Domain"**
3. Enter your domain: `api.wolvcapital.com`
4. Railway provides DNS records (CNAME or A record)

### 2. Configure DNS

Add the following to your domain's DNS settings:

**For API subdomain**:
```
Type: CNAME
Name: api
Value: <your-railway-app>.up.railway.app
TTL: 3600
```

**For root domain** (if hosting backend on root):
```
Type: A
Name: @
Value: <Railway IP address>
TTL: 3600
```

### 3. Update Environment Variables

After domain is verified, update:

```bash
ALLOWED_HOSTS=api.wolvcapital.com,wolvcapital-production.up.railway.app
CSRF_TRUSTED_ORIGINS=https://api.wolvcapital.com,https://wolvcapital.com
ADMIN_SITE_URL=https://api.wolvcapital.com
```

## üîê Security Checklist

- ‚úÖ `DEBUG=0` in production
- ‚úÖ Strong `SECRET_KEY` (50+ random characters)
- ‚úÖ `ALLOWED_HOSTS` configured with actual domains
- ‚úÖ `CORS_ALLOWED_ORIGINS` limited to frontend domain only
- ‚úÖ `CSRF_TRUSTED_ORIGINS` matches CORS + backend domain
- ‚úÖ HTTPS enforced (automatic with Railway)
- ‚úÖ Database backups enabled (Railway provides automatic backups)

## üìà Monitoring & Logs

### View Logs

**Railway Dashboard**:
1. Go to your service
2. Click **"Deployments"** tab
3. Select active deployment
4. View real-time logs

**Railway CLI**:
```bash
railway logs
```

### Health Monitoring

Railway automatically monitors your `/healthz/` endpoint. If it fails:
- Service will restart automatically
- You'll receive notifications (if configured)

## üõ†Ô∏è Troubleshooting

### Migration Failures

```bash
# Connect to Railway shell
railway run python manage.py migrate --noinput

# Check migration status
railway run python manage.py showmigrations
```

### Missing Investment Plans

```bash
railway run python manage.py seed_plans
```

### Static Files Not Loading

```bash
railway run python manage.py collectstatic --noinput
```

### Database Connection Issues

1. Check `DATABASE_URL` is set correctly
2. Verify PostgreSQL service is running
3. Check Railway service logs for connection errors

### 502 Bad Gateway

Common causes:
- Gunicorn not starting properly
- Port binding issues (Railway sets `PORT` automatically)
- Health check failing

Check logs:
```bash
railway logs --tail
```

## üöÄ CI/CD & Automated Deployments

Railway automatically deploys when you:
1. Push to `main` branch (default)
2. Merge a pull request
3. Create a new release tag

### Configure Deploy Triggers

In Railway dashboard:
1. Service ‚Üí **Settings** ‚Üí **Deploy**
2. Choose trigger branch: `main`, `production`, etc.
3. Enable/disable PR previews

### Rollback Deployment

1. Go to **Deployments** tab
2. Find previous successful deployment
3. Click **"Redeploy"**

## üí∞ Cost Estimation

Railway pricing (as of 2026):
- **Hobby Plan**: $5/month
  - 500 hours usage
  - Good for side projects
  
- **Pro Plan**: $20/month
  - Unlimited usage
  - Production workloads
  - Team collaboration

**Database**: ~$5-10/month for PostgreSQL (included in Pro)

## üîÑ Migration from Render.com

If migrating from Render:

1. **Export Database**:
   ```bash
   # On Render
   pg_dump $DATABASE_URL > dump.sql
   ```

2. **Import to Railway**:
   ```bash
   # Get Railway DATABASE_URL
   railway variables
   
   # Import dump
   psql $DATABASE_URL < dump.sql
   ```

3. **Update DNS**: Point domains to Railway
4. **Test thoroughly** before switching DNS

## üìö Additional Resources

- [Railway Documentation](https://docs.railway.app)
- [Railway CLI](https://docs.railway.app/develop/cli)
- [Python Deployment Guide](https://docs.railway.app/guides/python)
- [PostgreSQL Guide](https://docs.railway.app/databases/postgresql)

## üÜò Support

- **Railway Support**: [Discord](https://discord.gg/railway)
- **WolvCapital Issues**: GitHub Issues
- **Documentation**: This guide + project README files

---

**Next Steps After Deployment**:
1. ‚úÖ Deploy Django backend to Railway
2. ‚úÖ Deploy Next.js frontend to Vercel
3. ‚úÖ Configure custom domains
4. ‚úÖ Set up email notifications
5. ‚úÖ Create admin user
6. ‚úÖ Test end-to-end workflows
